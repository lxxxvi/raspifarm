<!DOCTYPE html>

<html>

  <head>
    <meta charset="UTF-8" />
    <title>Raspifarm Dog</title>
    <link rel="stylesheet" href="css/foundation.min.css" type="text/css"></link>
  </head>
  <body>

    <div class="row">
      <h1>Raspidog</h1>
    </div>

    <div class="nodes">

      <div class="expanded2 row">

        <div id="192-168-17-1" class="callout success small-12 medium-4 columns node">
          <h3>192.168.17.1</h3>
          <div class="workload">

            <div class="cpu">
              <h5>CPU</h5>
              <div class="progress" role="progressbar" tabindex="0" aria-valuenow="0" aria-valuemin="0" aria-valuetext="0 percent" aria-valuemax="100">
                <span class="progress-meter" style="width: 0%">
                  <p class="progress-meter-text">
                    <span class="used_percent">0%</span>
                  </p>
                </span>
              </div>
            </div>

            <div class="memory">
              <h5>Memory</h5>

              <span class="used_kb">0kb</span> of <span class="total_kb">0kb</span> used

              <div class="progress" role="progressbar" tabindex="0" aria-valuenow="0" aria-valuemin="0" aria-valuetext="0 percent" aria-valuemax="100">
                <span class="progress-meter" style="width: 0%">
                  <p class="progress-meter-text">
                    <span class="used_percent">0%</span>
                  </p>
                </span>
              </div>

            </div>
          </div>
          <!-- WORKLOAD END -->
        </div>

        <div class="medium-8 columns">
          <span class="label">Info</span><br />
          Due to a <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=712329">bug in Firefox</a> (Version &lt; 48), this site may not be refreshed correctly. Try it with chrome.

        </div>


      </div>

      <div class="expanded2 row">

        <div id="192-168-17-11" class="callout primary small-12 medium-3 columns node">
          <h3>192.168.17.11</h3>
          <div class="workload">

            <div class="cpu">
              <h5>CPU</h5>
              <div class="progress" role="progressbar" tabindex="0" aria-valuenow="0" aria-valuemin="0" aria-valuetext="0 percent" aria-valuemax="100">
                <span class="progress-meter" style="width: 0%">
                  <p class="progress-meter-text">
                    <span class="used_percent">0%</span>
                  </p>
                </span>
              </div>
            </div>

            <div class="memory">
              <h5>Memory</h5>

              <span class="used_kb">0kb</span> of <span class="total_kb">0kb</span> used

              <div class="progress" role="progressbar" tabindex="0" aria-valuenow="0" aria-valuemin="0" aria-valuetext="0 percent" aria-valuemax="100">
                <span class="progress-meter" style="width: 0%">
                  <p class="progress-meter-text">
                    <span class="used_percent">0%</span>
                  </p>
                </span>
              </div>

            </div>
          </div>
          <!-- WORKLOAD END -->
        </div>

        <div id="192-168-17-12" class="callout primary small-12 medium-3 columns node">
          <h3>192.168.17.12</h3>
          <div class="workload">

            <div class="cpu">
              <h5>CPU</h5>
              <div class="progress" role="progressbar" tabindex="0" aria-valuenow="0" aria-valuemin="0" aria-valuetext="0 percent" aria-valuemax="100">
                <span class="progress-meter" style="width: 0%">
                  <p class="progress-meter-text">
                    <span class="used_percent">0%</span>
                  </p>
                </span>
              </div>
            </div>

            <div class="memory">
              <h5>Memory</h5>

              <span class="used_kb">0kb</span> of <span class="total_kb">0kb</span> used

              <div class="progress" role="progressbar" tabindex="0" aria-valuenow="0" aria-valuemin="0" aria-valuetext="0 percent" aria-valuemax="100">
                <span class="progress-meter" style="width: 0%">
                  <p class="progress-meter-text">
                    <span class="used_percent">0%</span>
                  </p>
                </span>
              </div>

            </div>
          </div>
          <!-- WORKLOAD END -->
        </div>

        <div id="192-168-17-13" class="callout primary small-12 medium-3 columns node">
          <h3>192.168.17.13</h3>
          <div class="workload">

            <div class="cpu">
              <h5>CPU</h5>
              <div class="progress" role="progressbar" tabindex="0" aria-valuenow="0" aria-valuemin="0" aria-valuetext="0 percent" aria-valuemax="100">
                <span class="progress-meter" style="width: 0%">
                  <p class="progress-meter-text">
                    <span class="used_percent">0%</span>
                  </p>
                </span>
              </div>
            </div>

            <div class="memory">
              <h5>Memory</h5>

              <span class="used_kb">0kb</span> of <span class="total_kb">0kb</span> used

              <div class="progress" role="progressbar" tabindex="0" aria-valuenow="0" aria-valuemin="0" aria-valuetext="0 percent" aria-valuemax="100">
                <span class="progress-meter" style="width: 0%">
                  <p class="progress-meter-text">
                    <span class="used_percent">0%</span>
                  </p>
                </span>
              </div>

            </div>
          </div>
          <!-- WORKLOAD END -->
        </div>

        <div id="192-168-17-14" class="callout primary small-12 medium-3 columns node">
          <h3>192.168.17.14</h3>

          <div class="workload">

            <div class="cpu">
              <h5>CPU</h5>
              <div class="progress" role="progressbar" tabindex="0" aria-valuenow="0" aria-valuemin="0" aria-valuetext="0 percent" aria-valuemax="100">
                <span class="progress-meter" style="width: 0%">
                  <p class="progress-meter-text">
                    <span class="used_percent">0%</span>
                  </p>
                </span>
              </div>
            </div>

            <div class="memory">
              <h5>Memory</h5>

              <span class="used_kb">0kb</span> of <span class="total_kb">0kb</span> used

              <div class="progress" role="progressbar" tabindex="0" aria-valuenow="0" aria-valuemin="0" aria-valuetext="0 percent" aria-valuemax="100">
                <span class="progress-meter" style="width: 0%">
                  <p class="progress-meter-text">
                    <span class="used_percent">0%</span>
                  </p>
                </span>
              </div>

            </div>
          </div>
          <!-- WORKLOAD END -->

        </div>

      </div>

      <div class="expanded2 row">

        <div id="192-168-17-15" class="callout primary small-12 medium-3 columns node">
          <h3>192.168.17.15</h3>
          <div class="workload">

            <div class="cpu">
              <h5>CPU</h5>
              <div class="progress" role="progressbar" tabindex="0" aria-valuenow="0" aria-valuemin="0" aria-valuetext="0 percent" aria-valuemax="100">
                <span class="progress-meter" style="width: 0%">
                  <p class="progress-meter-text">
                    <span class="used_percent">0%</span>
                  </p>
                </span>
              </div>
            </div>

            <div class="memory">
              <h5>Memory</h5>

              <span class="used_kb">0kb</span> of <span class="total_kb">0kb</span> used

              <div class="progress" role="progressbar" tabindex="0" aria-valuenow="0" aria-valuemin="0" aria-valuetext="0 percent" aria-valuemax="100">
                <span class="progress-meter" style="width: 0%">
                  <p class="progress-meter-text">
                    <span class="used_percent">0%</span>
                  </p>
                </span>
              </div>

            </div>
          </div>
          <!-- WORKLOAD END -->
        </div>

        <div id="192-168-17-16" class="callout primary small-12 medium-3 columns node">
          <h3>192.168.17.16</h3>
          <div class="workload">

            <div class="cpu">
              <h5>CPU</h5>
              <div class="progress" role="progressbar" tabindex="0" aria-valuenow="0" aria-valuemin="0" aria-valuetext="0 percent" aria-valuemax="100">
                <span class="progress-meter" style="width: 0%">
                  <p class="progress-meter-text">
                    <span class="used_percent">0%</span>
                  </p>
                </span>
              </div>
            </div>

            <div class="memory">
              <h5>Memory</h5>

              <span class="used_kb">0kb</span> of <span class="total_kb">0kb</span> used

              <div class="progress" role="progressbar" tabindex="0" aria-valuenow="0" aria-valuemin="0" aria-valuetext="0 percent" aria-valuemax="100">
                <span class="progress-meter" style="width: 0%">
                  <p class="progress-meter-text">
                    <span class="used_percent">0%</span>
                  </p>
                </span>
              </div>

            </div>
          </div>
          <!-- WORKLOAD END -->
        </div>

        <div id="192-168-17-17" class="callout primary small-12 medium-3 columns node">
          <h3>192.168.17.17</h3>
          <div class="workload">

            <div class="cpu">
              <h5>CPU</h5>
              <div class="progress" role="progressbar" tabindex="0" aria-valuenow="0" aria-valuemin="0" aria-valuetext="0 percent" aria-valuemax="100">
                <span class="progress-meter" style="width: 0%">
                  <p class="progress-meter-text">
                    <span class="used_percent">0%</span>
                  </p>
                </span>
              </div>
            </div>

            <div class="memory">
              <h5>Memory</h5>

              <span class="used_kb">0kb</span> of <span class="total_kb">0kb</span> used

              <div class="progress" role="progressbar" tabindex="0" aria-valuenow="0" aria-valuemin="0" aria-valuetext="0 percent" aria-valuemax="100">
                <span class="progress-meter" style="width: 0%">
                  <p class="progress-meter-text">
                    <span class="used_percent">0%</span>
                  </p>
                </span>
              </div>

            </div>
          </div>
          <!-- WORKLOAD END -->
        </div>

        <div id="192-168-17-18" class="callout primary small-12 medium-3 columns node">
          <h3>192.168.17.18</h3>

          <div class="workload">

            <div class="cpu">
              <h5>CPU</h5>
              <div class="progress" role="progressbar" tabindex="0" aria-valuenow="0" aria-valuemin="0" aria-valuetext="0 percent" aria-valuemax="100">
                <span class="progress-meter" style="width: 0%">
                  <p class="progress-meter-text">
                    <span class="used_percent">0%</span>
                  </p>
                </span>
              </div>
            </div>

            <div class="memory">
              <h5>Memory</h5>

              <span class="used_kb">0kb</span> of <span class="total_kb">0kb</span> used

              <div class="progress" role="progressbar" tabindex="0" aria-valuenow="0" aria-valuemin="0" aria-valuetext="0 percent" aria-valuemax="100">
                <span class="progress-meter" style="width: 0%">
                  <p class="progress-meter-text">
                    <span class="used_percent">0%</span>
                  </p>
                </span>
              </div>

            </div>
          </div>
          <!-- WORKLOAD END -->

        </div>

      </div>

      <div class="row expanded2">
        <div class="small-12 medium-12 columns">
          Powered by <br/>
          <img src="/images/nodejs.svg" width="100px" alt="Node JS" />
          <img src="/images/foundation.svg" width="100px" alt="Foundation" />
          <img src="/images/socket-io.svg" width="100px" alt="Socket.IO" />
          <img src="/images/jquery.svg" width="100px" alt="Socket.IO" />
        </div>
      </div>


    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="js//jquery.min.js"></script>

    <script>


      function dasherize(string) {
        return string.split('.').join('-');
      }

      function dotterize(string) {
        return string.split('-').join('.');
      }

      function updateCpuUsage(node_id, cpu) {
        var cpu_element = $('#' + node_id + ' .workload .cpu');
        var cpu_element_progress = cpu_element.find('.progress');

        cpu_element.find('.used_percent').html(cpu.used_percent + '%');
        cpu_element_progress.find('.progress-meter').css('width', cpu.used_percent + '%');
        cpu_element_progress.attr('aria-valuenow', cpu.used_percent);
        cpu_element_progress.attr('aria-valuetext', cpu.used_percent + ' percent');
      }

      function updateMemoryUsage(node_id, memory) {
        var memory_element = $('#' + node_id + ' .workload .memory');
        var memory_element_progress = memory_element.find('.progress');

        memory_element.find('.used_kb').text(memory.used + 'kb');
        memory_element.find('.total_kb').text(memory.total + 'kb');

        memory_element.find('.used_percent').html(memory.used_percent + '%');
        memory_element_progress.find('.progress-meter').css('width', memory.used_percent + '%');
        memory_element_progress.attr('aria-valuenow', memory.used_percent);
        memory_element_progress.attr('aria-valuetext', memory.used_percent + ' percent');
      }

      function renderWorkloadFor(address, workload) {
        var dasherizedAddress = dasherize(address);

        updateCpuUsage(dasherizedAddress, workload.cpu);
        updateMemoryUsage(dasherizedAddress, workload.memory);
      }

      // listen to the stream
      var socket = io();

      $(window).on('beforeunload', function(){
          socket.close();
      })

      socket.on('workload', function(response) {
        renderWorkloadFor(response.ip_address, response.workload);
      });

      socket.on('date', function(response) {
        console.log("date", response);
      });

    </script>
  </body>


</html>
